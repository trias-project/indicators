<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Damiano Oldoni" />

<meta name="date" content="2020-04-06" />

<title>Species observations and occupancy in Belgian protected areas</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="static\css\trias.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">TrIAS pipeline</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Checklist-based indicators
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="indicator_introductions_per_year.html">New species introductions</a>
    </li>
    <li>
      <a href="indicator_cumulative_number.html">Cumulative number of species</a>
    </li>
    <li>
      <a href="indicator_pathways.html">Introduction pathways</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Occurrence-based indicators
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="occurrence_indicators_appearing_taxa.html">Appearing-reappearing species</a>
    </li>
    <li>
      <a href="occurrence_indicators_modelling.html">Assessing emerging status of alien species</a>
    </li>
    <li>
      <a href="ranking_emerging_status.html">Ranking species by emerging status</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Appendix
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="get_data_input_checklist_indicators.html">Preprocessing for checklist-based indicators</a>
    </li>
    <li>
      <a href="occurrence_indicators_preprocessing.html">Preprocessing for occurrence-based indicators</a>
    </li>
    <li>
      <a href="occurrence_species_protected_areas_level.html">Species in Belgian protected areas</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/trias-project/pipeline">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Species observations and occupancy in Belgian protected areas</h1>
<h4 class="author">Damiano Oldoni</h4>
<h4 class="date">2020-04-06</h4>

</div>


<div id="goal" class="section level1">
<h1>Goal</h1>
<p>This document aims to calculate the species occupancy and the number of obsrvations in Belgian natura2000 protected areas. Data are aggregated per year, species and at a resolution of 1 km x 1km as we use the EEA reference grid for Belgium.</p>
</div>
<div id="setup" class="section level1">
<h1>Setup</h1>
<pre class="r"><code>library(tidyverse)
library(tidylog)
library(here)
library(inborutils)
library(rgbif)</code></pre>
</div>
<div id="read-input-data" class="section level1">
<h1>Read input data</h1>
<div id="occurrence-cube-at-species-level" class="section level2">
<h2>Occurrence cube at species level</h2>
<p>Read the occurrence cubes at species level for European countries as published on Zenodo (<a href="https://zenodo.org/record/3637911" class="uri">https://zenodo.org/record/3637911</a>). It can take a long time:</p>
<pre class="r"><code>if (!&quot;be_species_cube.csv&quot; %in%
  list.files(here::here(&quot;data&quot;, &quot;interim&quot;))) {
  download_zenodo(
    doi = &quot;10.5281/zenodo.3637911&quot;,
    path = here::here(&quot;data&quot;, &quot;interim&quot;)
  )
}</code></pre>
<p>We are interested in the Belgian cube (<code>be_species_cube.csv</code>) and its metadata (<code>be_species_info.csv</code>):</p>
<pre class="r"><code>be_species_cube &lt;- read_csv(
  file = here::here(&quot;data&quot;, &quot;interim&quot;, &quot;be_species_cube.csv&quot;),
  na = &quot;&quot;
)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   year = col_double(),
##   eea_cell_code = col_character(),
##   speciesKey = col_double(),
##   n = col_double(),
##   min_coord_uncertainty = col_double()
## )</code></pre>
<pre class="r"><code>be_species_info &lt;- read_csv(
  file = here::here(&quot;data&quot;, &quot;interim&quot;, &quot;be_species_info.csv&quot;),
  na = &quot;&quot;
)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   speciesKey = col_double(),
##   scientificName = col_character(),
##   rank = col_character(),
##   taxonomicStatus = col_character(),
##   includes = col_character()
## )</code></pre>
<p>Preview occurrence cube:</p>
<pre class="r"><code>be_species_cube %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["eea_cell_code"],"name":[2],"type":["chr"],"align":["left"]},{"label":["speciesKey"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["min_coord_uncertainty"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1664","2":"1kmE4044N3045","3":"2722602","4":"1","5":"1000"},{"1":"1700","2":"1kmE3802N3133","3":"2287248","4":"1","5":"301"},{"1":"1700","2":"1kmE3802N3133","3":"2287250","4":"1","5":"301"},{"1":"1700","2":"1kmE3802N3133","3":"2287615","4":"1","5":"301"},{"1":"1700","2":"1kmE3802N3133","3":"2288788","4":"1","5":"301"},{"1":"1700","2":"1kmE3802N3133","3":"2294290","4":"1","5":"301"},{"1":"1700","2":"1kmE3802N3133","3":"2296807","4":"1","5":"301"},{"1":"1700","2":"1kmE3802N3133","3":"4372981","4":"1","5":"301"},{"1":"1700","2":"1kmE3802N3133","3":"4562917","4":"1","5":"301"},{"1":"1700","2":"1kmE3802N3133","3":"5188981","4":"1","5":"301"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Preview taxonomic metadata of occurrence cube:</p>
<pre class="r"><code>be_species_info %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["speciesKey"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["scientificName"],"name":[2],"type":["chr"],"align":["left"]},{"label":["rank"],"name":[3],"type":["chr"],"align":["left"]},{"label":["taxonomicStatus"],"name":[4],"type":["chr"],"align":["left"]},{"label":["includes"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"1000106","2":"Methanobacterium alcaliphilum Worakit et al., 1986","3":"SPECIES","4":"ACCEPTED","5":"1000106: Methanobacterium alcaliphilum Worakit et al., 1986"},{"1":"1000484","2":"Filinia terminalis (Plate, 1886)","3":"SPECIES","4":"ACCEPTED","5":"1000484: Filinia terminalis (Plate, 1886)"},{"1":"1001548","2":"Lepadella deridderae Segers, De Smet & Bonte, 1996","3":"SPECIES","4":"ACCEPTED","5":"6155426: Lepadella deridderae deridderae"},{"1":"1001728","2":"Paradicranophorus sinus De Smet, 2003","3":"SPECIES","4":"ACCEPTED","5":"1001728: Paradicranophorus sinus De Smet, 2003"},{"1":"1001810","2":"Encentrum tenuidigitatum De Smet, 2000","3":"SPECIES","4":"ACCEPTED","5":"1001810: Encentrum tenuidigitatum De Smet, 2000"},{"1":"1001922","2":"Asplanchna priodonta Gosse, 1850","3":"SPECIES","4":"ACCEPTED","5":"1001922: Asplanchna priodonta Gosse, 1850"},{"1":"1002567","2":"Cotylegaleata perplexa De Smet, 2007","3":"SPECIES","4":"ACCEPTED","5":"1002567: Cotylegaleata perplexa De Smet, 2007"},{"1":"1002590","2":"Keratella cochlearis (Gosse, 1851)","3":"SPECIES","4":"ACCEPTED","5":"1002590: Keratella cochlearis (Gosse, 1851)"},{"1":"1002618","2":"Keratella ticinensis (Callerio, 1920)","3":"SPECIES","4":"ACCEPTED","5":"1002618: Keratella ticinensis (Callerio, 1920)"},{"1":"1002639","2":"Keratella tecta (Gosse, 1851)","3":"SPECIES","4":"ACCEPTED","5":"4289565: Keratella cochlearis tecta (Gosse, 1851)"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="global-register-of-introduced-and-invasive-species---belgium" class="section level2">
<h2>Global Register of Introduced and Invasive Species - Belgium</h2>
<p>We also retrieve the <a href="https://www.gbif.org/dataset/6d9e952f-948c-4483-9807-575348147c7e">Global Register of Introduced and Invasive Species - Belgium</a> from GBIF, which is sometimes called the <a href="https://github.com/trias-project/unified-checklist">unified checklist</a>:</p>
<pre class="r"><code>alien_taxa &lt;- name_usage(
  datasetKey = &quot;6d9e952f-948c-4483-9807-575348147c7e&quot;,
  return = &quot;data&quot;,
  limit = 10000
) %&gt;%
  filter(origin == &quot;SOURCE&quot;)</code></pre>
<pre><code>## filter: removed 1,968 rows (41%), 2,883 rows remaining</code></pre>
<p>Preview:</p>
<pre class="r"><code>alien_taxa %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["key"],"name":[1],"type":["int"],"align":["right"]},{"label":["nubKey"],"name":[2],"type":["int"],"align":["right"]},{"label":["nameKey"],"name":[3],"type":["int"],"align":["right"]},{"label":["taxonID"],"name":[4],"type":["chr"],"align":["left"]},{"label":["kingdom"],"name":[5],"type":["chr"],"align":["left"]},{"label":["phylum"],"name":[6],"type":["chr"],"align":["left"]},{"label":["order"],"name":[7],"type":["chr"],"align":["left"]},{"label":["family"],"name":[8],"type":["chr"],"align":["left"]},{"label":["genus"],"name":[9],"type":["chr"],"align":["left"]},{"label":["species"],"name":[10],"type":["chr"],"align":["left"]},{"label":["kingdomKey"],"name":[11],"type":["int"],"align":["right"]},{"label":["phylumKey"],"name":[12],"type":["int"],"align":["right"]},{"label":["classKey"],"name":[13],"type":["int"],"align":["right"]},{"label":["orderKey"],"name":[14],"type":["int"],"align":["right"]},{"label":["familyKey"],"name":[15],"type":["int"],"align":["right"]},{"label":["genusKey"],"name":[16],"type":["int"],"align":["right"]},{"label":["speciesKey"],"name":[17],"type":["int"],"align":["right"]},{"label":["datasetKey"],"name":[18],"type":["chr"],"align":["left"]},{"label":["parentKey"],"name":[19],"type":["int"],"align":["right"]},{"label":["parent"],"name":[20],"type":["chr"],"align":["left"]},{"label":["scientificName"],"name":[21],"type":["chr"],"align":["left"]},{"label":["canonicalName"],"name":[22],"type":["chr"],"align":["left"]},{"label":["authorship"],"name":[23],"type":["chr"],"align":["left"]},{"label":["nameType"],"name":[24],"type":["chr"],"align":["left"]},{"label":["rank"],"name":[25],"type":["chr"],"align":["left"]},{"label":["origin"],"name":[26],"type":["chr"],"align":["left"]},{"label":["taxonomicStatus"],"name":[27],"type":["chr"],"align":["left"]},{"label":["nomenclaturalStatus"],"name":[28],"type":["lgl"],"align":["right"]},{"label":["remarks"],"name":[29],"type":["chr"],"align":["left"]},{"label":["numDescendants"],"name":[30],"type":["int"],"align":["right"]},{"label":["references"],"name":[31],"type":["chr"],"align":["left"]},{"label":["lastCrawled"],"name":[32],"type":["chr"],"align":["left"]},{"label":["lastInterpreted"],"name":[33],"type":["chr"],"align":["left"]},{"label":["issues"],"name":[34],"type":["chr"],"align":["left"]},{"label":["synonym"],"name":[35],"type":["lgl"],"align":["right"]},{"label":["class"],"name":[36],"type":["chr"],"align":["left"]},{"label":["acceptedKey"],"name":[37],"type":["int"],"align":["right"]},{"label":["accepted"],"name":[38],"type":["chr"],"align":["left"]}],"data":[{"1":"152543101","2":"5740285","3":"18184572","4":"https://www.gbif.org/species/5740285","5":"Animalia","6":"Platyhelminthes","7":"Gyrodactylidea","8":"Gyrodactylidae","9":"Gyrodactylus","10":"Gyrodactylus proterorhini","11":"162643950","12":"162643969","13":"162643971","14":"162643972","15":"162643974","16":"162643976","17":"152543101","18":"6d9e952f-948c-4483-9807-575348147c7e","19":"162643976","20":"Gyrodactylus","21":"Gyrodactylus proterorhini Ergens, 1967","22":"Gyrodactylus proterorhini","23":"Ergens, 1967","24":"SCIENTIFIC","25":"SPECIES","26":"SOURCE","27":"ACCEPTED","28":"NA","29":"Sources considered for this taxon: https://doi.org/10.15468/3pmlxs","30":"0","31":"https://www.gbif.org/species/5740285","32":"2020-03-19T13:30:50.284+0000","33":"2020-03-19T13:31:04.360+0000","34":"","35":"FALSE","36":"Monogenea","37":"NA","38":"NA"},{"1":"152543102","2":"3202936","3":"806823","4":"https://www.gbif.org/species/3202936","5":"Chromista","6":"Oomycota","7":"Saprolegniales","8":"Leptolegniaceae","9":"Aphanomyces","10":"Aphanomyces astaci","11":"162643951","12":"162643963","13":"162643965","14":"162643967","15":"162643968","16":"162643970","17":"152543102","18":"6d9e952f-948c-4483-9807-575348147c7e","19":"162643970","20":"Aphanomyces","21":"Aphanomyces astaci Schikora","22":"Aphanomyces astaci","23":"Schikora","24":"SCIENTIFIC","25":"SPECIES","26":"SOURCE","27":"ACCEPTED","28":"NA","29":"Sources considered for this taxon: https://doi.org/10.15468/3pmlxs","30":"0","31":"https://www.gbif.org/species/3202936","32":"2020-03-19T13:30:50.284+0000","33":"2020-03-19T13:31:04.343+0000","34":"","35":"FALSE","36":"Peronosporea","37":"NA","38":"NA"},{"1":"152543110","2":"5179027","3":"15411920","4":"https://www.gbif.org/species/5179027","5":"Animalia","6":"Arthropoda","7":"Scutigeromorpha","8":"Scutigeridae","9":"Scutigera","10":"Scutigera coleoptrata","11":"162643950","12":"162644794","13":"162644803","14":"162644805","15":"162644807","16":"162644808","17":"152543110","18":"6d9e952f-948c-4483-9807-575348147c7e","19":"162644808","20":"Scutigera","21":"Scutigera coleoptrata Linnaeus, 1758","22":"Scutigera coleoptrata","23":"Linnaeus, 1758","24":"SCIENTIFIC","25":"SPECIES","26":"SOURCE","27":"ACCEPTED","28":"NA","29":"Sources considered for this taxon: https://doi.org/10.15468/3pmlxs","30":"0","31":"https://www.gbif.org/species/5179027","32":"2020-03-19T13:30:50.284+0000","33":"2020-03-19T13:31:07.644+0000","34":"","35":"FALSE","36":"Chilopoda","37":"NA","38":"NA"},{"1":"152543115","2":"5250069","3":"17244014","4":"https://www.gbif.org/species/5250069","5":"Fungi","6":"Basidiomycota","7":"Urocystidales","8":"Glomosporiaceae","9":"Thecaphora","10":"Thecaphora oxalidis","11":"162643973","12":"162643983","13":"162643985","14":"162643987","15":"162643988","16":"162643989","17":"152543115","18":"6d9e952f-948c-4483-9807-575348147c7e","19":"162643989","20":"Thecaphora","21":"Thecaphora oxalidis (Ellis & Tracy) M.Lutz, R.Bauer & Piatek","22":"Thecaphora oxalidis","23":"M.Lutz, R.Bauer & Piatek (Ellis & Tracy)","24":"SCIENTIFIC","25":"SPECIES","26":"SOURCE","27":"ACCEPTED","28":"NA","29":"Sources considered for this taxon: https://doi.org/10.15468/3pmlxs","30":"0","31":"https://www.gbif.org/species/5250069","32":"2020-03-19T13:30:50.284+0000","33":"2020-03-19T13:31:04.405+0000","34":"","35":"FALSE","36":"Ustilaginomycetes","37":"NA","38":"NA"},{"1":"152543120","2":"4985072","3":"11388843","4":"https://www.gbif.org/species/4985072","5":"Animalia","6":"Bryozoa","7":"Cheilostomatida","8":"Candidae","9":"Tricellaria","10":"Tricellaria inopinata","11":"162643950","12":"162645250","13":"162645251","14":"162645255","15":"162645256","16":"162645258","17":"152543120","18":"6d9e952f-948c-4483-9807-575348147c7e","19":"162645258","20":"Tricellaria","21":"Tricellaria inopinata d'Hondt & Occhipinti Ambrogi, 1985","22":"Tricellaria inopinata","23":"d'Hondt & Occhipinti Ambrogi, 1985","24":"SCIENTIFIC","25":"SPECIES","26":"SOURCE","27":"ACCEPTED","28":"NA","29":"Sources considered for this taxon: https://doi.org/10.14284/347, https://doi.org/10.15468/3pmlxs","30":"0","31":"https://www.gbif.org/species/4985072","32":"2020-03-19T13:30:50.284+0000","33":"2020-03-19T13:31:09.059+0000","34":"","35":"FALSE","36":"Gymnolaemata","37":"NA","38":"NA"},{"1":"152543121","2":"5250090","3":"11643170","4":"https://www.gbif.org/species/5250090","5":"Fungi","6":"Basidiomycota","7":"Urocystidales","8":"Urocystidaceae","9":"Urocystis","10":"Urocystis trollii","11":"162643973","12":"162643983","13":"162643985","14":"162643987","15":"162643992","16":"162643993","17":"152543121","18":"6d9e952f-948c-4483-9807-575348147c7e","19":"162643993","20":"Urocystis","21":"Urocystis trollii Nannf.","22":"Urocystis trollii","23":"Nannf.","24":"SCIENTIFIC","25":"SPECIES","26":"SOURCE","27":"ACCEPTED","28":"NA","29":"Sources considered for this taxon: https://doi.org/10.15468/3pmlxs","30":"0","31":"https://www.gbif.org/species/5250090","32":"2020-03-19T13:30:50.284+0000","33":"2020-03-19T13:31:04.419+0000","34":"","35":"FALSE","36":"Ustilaginomycetes","37":"NA","38":"NA"},{"1":"152543128","2":"2557730","3":"10621933","4":"https://www.gbif.org/species/2557730","5":"Fungi","6":"Basidiomycota","7":"Ustilaginales","8":"Ustilaginaceae","9":"Sporisorium","10":"Sporisorium destruens","11":"162643973","12":"162643983","13":"162643985","14":"162643995","15":"162643997","16":"162644001","17":"152543128","18":"6d9e952f-948c-4483-9807-575348147c7e","19":"162644001","20":"Sporisorium","21":"Sporisorium destruens (Schltdl.) Vánky","22":"Sporisorium destruens","23":"Vánky (Schltdl.)","24":"SCIENTIFIC","25":"SPECIES","26":"SOURCE","27":"ACCEPTED","28":"NA","29":"Sources considered for this taxon: https://doi.org/10.15468/3pmlxs","30":"0","31":"https://www.gbif.org/species/2557730","32":"2020-03-19T13:30:50.284+0000","33":"2020-03-19T13:31:04.450+0000","34":"","35":"FALSE","36":"Ustilaginomycetes","37":"NA","38":"NA"},{"1":"152543131","2":"2557469","3":"11667261","4":"https://www.gbif.org/species/2557469","5":"Fungi","6":"Basidiomycota","7":"Ustilaginales","8":"Ustilaginaceae","9":"Ustilago","10":"Ustilago maydis","11":"162643973","12":"162643983","13":"162643985","14":"162643995","15":"162643997","16":"162643998","17":"152543131","18":"6d9e952f-948c-4483-9807-575348147c7e","19":"162643998","20":"Ustilago","21":"Ustilago maydis (DC.) Corda","22":"Ustilago maydis","23":"Corda (DC.)","24":"SCIENTIFIC","25":"SPECIES","26":"SOURCE","27":"ACCEPTED","28":"NA","29":"Sources considered for this taxon: https://doi.org/10.15468/3pmlxs","30":"0","31":"https://www.gbif.org/species/2557469","32":"2020-03-19T13:30:50.284+0000","33":"2020-03-19T13:31:04.439+0000","34":"","35":"FALSE","36":"Ustilaginomycetes","37":"NA","38":"NA"},{"1":"152543132","2":"6157050","3":"16703179","4":"https://www.gbif.org/species/6157050","5":"Animalia","6":"Chordata","7":"Testudines","8":"Emydidae","9":"Graptemys","10":"NA","11":"162643950","12":"162644009","13":"162644010","14":"162644012","15":"162644014","16":"162644019","17":"NA","18":"6d9e952f-948c-4483-9807-575348147c7e","19":"162644019","20":"Graptemys","21":"Graptemys pseudogeographica kohnii (Baur, 1890)","22":"Graptemys pseudogeographica kohnii","23":"(Baur, 1890)","24":"SCIENTIFIC","25":"SUBSPECIES","26":"SOURCE","27":"ACCEPTED","28":"NA","29":"Sources considered for this taxon: https://doi.org/10.15468/3pmlxs","30":"0","31":"https://www.gbif.org/species/6157050","32":"2020-03-19T13:30:50.284+0000","33":"2020-03-19T13:31:04.507+0000","34":"","35":"FALSE","36":"Reptilia","37":"NA","38":"NA"},{"1":"152543136","2":"7190901","3":"16703176","4":"https://www.gbif.org/species/7190901","5":"Animalia","6":"Chordata","7":"Testudines","8":"Emydidae","9":"Graptemys","10":"NA","11":"162643950","12":"162644009","13":"162644010","14":"162644012","15":"162644014","16":"162644019","17":"NA","18":"6d9e952f-948c-4483-9807-575348147c7e","19":"162644019","20":"Graptemys","21":"Graptemys pseudogeographica pseudogeographica","22":"Graptemys pseudogeographica pseudogeographica","23":"","24":"SCIENTIFIC","25":"SUBSPECIES","26":"SOURCE","27":"ACCEPTED","28":"NA","29":"Sources considered for this taxon: https://doi.org/10.15468/3pmlxs","30":"0","31":"https://www.gbif.org/species/7190901","32":"2020-03-19T13:30:50.284+0000","33":"2020-03-19T13:31:04.512+0000","34":"","35":"FALSE","36":"Reptilia","37":"NA","38":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Number of taxa per rank:</p>
<pre class="r"><code>alien_taxa %&gt;%
  group_by(rank) %&gt;%
  count()</code></pre>
<pre><code>## group_by: one grouping variable (rank)</code></pre>
<pre><code>## count: now 4 rows and 2 columns, one group variable remaining (rank)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["rank"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"GENUS","2":"11"},{"1":"SPECIES","2":"2749"},{"1":"SUBSPECIES","2":"103"},{"1":"VARIETY","2":"20"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Alien genera:</p>
<pre class="r"><code>genus_alien &lt;-
  alien_taxa %&gt;%
  filter(rank == &quot;GENUS&quot;)</code></pre>
<pre><code>## filter: removed 2,872 rows (&gt;99%), 11 rows remaining</code></pre>
<p>Infraspecific alien taxa:</p>
<pre class="r"><code>infraspecific_alien &lt;-
  alien_taxa %&gt;%
  filter(rank %in% c(&quot;SUBSPECIES&quot;, &quot;VARIETY&quot;)) %&gt;%
  select(-starts_with(&quot;species&quot;))</code></pre>
<pre><code>## filter: removed 2,760 rows (96%), 123 rows remaining</code></pre>
<pre><code>## select: dropped 2 variables (species, speciesKey)</code></pre>
<pre class="r"><code>infraspecific_alien &lt;-
  map_dfr(
    infraspecific_alien$nubKey,
    function(x) {
      name_usage(x, return = &quot;data&quot;)
    }
  )
infraspecific_alien &lt;-
  infraspecific_alien %&gt;%
  mutate(
    species = if_else(is.na(species),
      parent,
      species
    ),
    speciesKey = if_else(is.na(speciesKey),
      parentKey,
      speciesKey
    )
  )</code></pre>
<pre><code>## mutate: changed one value (1%) of &#39;species&#39; (1 fewer NA)</code></pre>
<pre><code>##         changed one value (1%) of &#39;speciesKey&#39; (1 fewer NA)</code></pre>
</div>
<div id="eea-cells-containing-the-natura2000-protected-areas" class="section level2">
<h2>EEA cells containing the Natura2000 protected areas</h2>
<p>We download also the file containing the intersection of protected areas and the EEA grid as produced in :</p>
<pre class="r"><code>cells_of_prot_areas &lt;- read_tsv(
  file = here::here(
    &quot;data&quot;,
    &quot;interim&quot;,
    &quot;EEA_ref_grid_cells_covering_protected_areas.tsv&quot;
  ),
  na = &quot;&quot;
)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   SITECODE = col_character(),
##   SITETYPE = col_character(),
##   CELLCODE = col_character()
## )</code></pre>
<p>Preview:</p>
<pre class="r"><code>cells_of_prot_areas %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["SITECODE"],"name":[1],"type":["chr"],"align":["left"]},{"label":["SITETYPE"],"name":[2],"type":["chr"],"align":["left"]},{"label":["CELLCODE"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"BE31001C0","2":"C","3":"1kmE3913N3077"},{"1":"BE31001C0","2":"C","3":"1kmE3914N3075"},{"1":"BE31001C0","2":"C","3":"1kmE3914N3076"},{"1":"BE31001C0","2":"C","3":"1kmE3914N3077"},{"1":"BE31001C0","2":"C","3":"1kmE3914N3078"},{"1":"BE31001C0","2":"C","3":"1kmE3914N3079"},{"1":"BE31001C0","2":"C","3":"1kmE3914N3080"},{"1":"BE31001C0","2":"C","3":"1kmE3915N3076"},{"1":"BE31001C0","2":"C","3":"1kmE3915N3077"},{"1":"BE31001C0","2":"C","3":"1kmE3915N3078"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Number of cells per protected area:</p>
<pre class="r"><code>n_cells_prot_areas &lt;-
  cells_of_prot_areas %&gt;%
  group_by(SITECODE) %&gt;%
  summarize(n_cells = n())</code></pre>
<pre><code>## group_by: one grouping variable (SITECODE)</code></pre>
<pre><code>## summarize: now 310 rows and 2 columns, ungrouped</code></pre>
<p>Preview:</p>
<pre class="r"><code>n_cells_prot_areas %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["SITECODE"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n_cells"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"BE1000001","2":"50"},{"1":"BE1000002","2":"10"},{"1":"BE1000003","2":"8"},{"1":"BE2100015","2":"37"},{"1":"BE2100016","2":"48"},{"1":"BE2100017","2":"160"},{"1":"BE2100019","2":"32"},{"1":"BE2100020","2":"36"},{"1":"BE2100024","2":"99"},{"1":"BE2100026","2":"155"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="protected-areas-metadata" class="section level2">
<h2>Protected areas metadata</h2>
<p>Metadata about all Belgian Natura2000 protected areas have been already saved in <a href="define_overlay_grid_belgium_with_protected_areas.html">other pipeline</a>. We read them:</p>
<pre class="r"><code>protected_areas_metadata &lt;- read_tsv(
  here::here(
    &quot;data&quot;,
    &quot;interim&quot;,
    &quot;protected_areas_metadata.tsv&quot;
  ),
  na = &quot;&quot;
)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   SITECODE = col_character(),
##   SITENAME = col_character(),
##   SITETYPE = col_character()
## )</code></pre>
</div>
</div>
<div id="calculate-number-of-observations-occupancy-and-coverage-of-belgian-protected-areas" class="section level1">
<h1>Calculate number of observations, occupancy and coverage of Belgian protected areas</h1>
<p>Get values from occurrence cube related to cells covering the protected areas:</p>
<pre class="r"><code>be_prot_areas_cube &lt;-
  cells_of_prot_areas %&gt;%
  inner_join(be_species_cube,
    by = c(&quot;CELLCODE&quot; = &quot;eea_cell_code&quot;)
  )</code></pre>
<pre><code>## inner_join: added 4 columns (year, speciesKey, n, min_coord_uncertainty)</code></pre>
<pre><code>##             &gt; rows only in x  (       79)</code></pre>
<pre><code>##             &gt; rows only in y  (9,741,517)</code></pre>
<pre><code>##             &gt; matched rows     8,167,530    (includes duplicates)</code></pre>
<pre><code>##             &gt;                 ===========</code></pre>
<pre><code>##             &gt; rows total       8,167,530</code></pre>
<p>Preview:</p>
<pre class="r"><code>be_prot_areas_cube %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["SITECODE"],"name":[1],"type":["chr"],"align":["left"]},{"label":["SITETYPE"],"name":[2],"type":["chr"],"align":["left"]},{"label":["CELLCODE"],"name":[3],"type":["chr"],"align":["left"]},{"label":["year"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["speciesKey"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["min_coord_uncertainty"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"BE31001C0","2":"C","3":"1kmE3913N3077","4":"1916","5":"8044896","6":"1","7":"10000"},{"1":"BE31001C0","2":"C","3":"1kmE3913N3077","4":"1940","5":"2703250","6":"1","7":"2800"},{"1":"BE31001C0","2":"C","3":"1kmE3913N3077","4":"1940","5":"2722602","6":"1","7":"2800"},{"1":"BE31001C0","2":"C","3":"1kmE3913N3077","4":"1940","5":"2975287","6":"1","7":"2800"},{"1":"BE31001C0","2":"C","3":"1kmE3913N3077","4":"1940","5":"3107361","6":"1","7":"2800"},{"1":"BE31001C0","2":"C","3":"1kmE3913N3077","4":"1940","5":"5331235","6":"1","7":"2800"},{"1":"BE31001C0","2":"C","3":"1kmE3913N3077","4":"1940","5":"5341308","6":"1","7":"2800"},{"1":"BE31001C0","2":"C","3":"1kmE3913N3077","4":"1940","5":"5372605","6":"1","7":"2800"},{"1":"BE31001C0","2":"C","3":"1kmE3913N3077","4":"1940","5":"7693914","6":"1","7":"2800"},{"1":"BE31001C0","2":"C","3":"1kmE3913N3077","4":"1940","5":"9039392","6":"1","7":"2800"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>For each taxon, year and protected area, calculate the number of observations, the area of occupancy and minimum coordinate uncertainty:</p>
<pre class="r"><code>occs_prot_areas &lt;-
  be_prot_areas_cube %&gt;%
  group_by(SITECODE, SITETYPE, year, speciesKey) %&gt;%
  summarize(
    aoo = n(),
    n = sum(n),
    min_coord_uncertainty = min(min_coord_uncertainty)
  ) %&gt;%
  ungroup()</code></pre>
<pre><code>## group_by: 4 grouping variables (SITECODE, SITETYPE, year, speciesKey)</code></pre>
<pre><code>## summarize: now 1,880,337 rows and 7 columns, 3 group variables remaining (SITECODE, SITETYPE, year)</code></pre>
<pre><code>## ungroup: no grouping variables</code></pre>
<p>Previewing the 10 highest area of occupancies:</p>
<pre class="r"><code>occs_prot_areas %&gt;%
  arrange(desc(aoo)) %&gt;%
  head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["SITECODE"],"name":[1],"type":["chr"],"align":["left"]},{"label":["SITETYPE"],"name":[2],"type":["chr"],"align":["left"]},{"label":["year"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["speciesKey"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["aoo"],"name":[5],"type":["int"],"align":["right"]},{"label":["n"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["min_coord_uncertainty"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"BEMNZ0001","2":"B","3":"2016","4":"2481174","5":"1022","6":"49131","7":"1"},{"1":"BEMNZ0001","2":"B","3":"2015","4":"2481174","5":"697","6":"2162","7":"2"},{"1":"BEMNZ0001","2":"B","3":"2014","4":"2481174","5":"606","6":"2584","7":"2"},{"1":"BEMNZ0001","2":"B","3":"2014","4":"2481139","5":"405","6":"42986","7":"2"},{"1":"BEMNZ0001","2":"B","3":"2013","4":"2481174","5":"394","6":"1493","7":"3"},{"1":"BEMNZ0001","2":"B","3":"2015","4":"2481139","5":"342","6":"61832","7":"2"},{"1":"BEMNZ0001","2":"B","3":"2016","4":"2481139","5":"326","6":"293184","7":"1"},{"1":"BE2300006","2":"B","3":"2014","4":"9761484","5":"276","6":"2346","7":"1000"},{"1":"BE2300006","2":"B","3":"2015","4":"9761484","5":"270","6":"2499","7":"1000"},{"1":"BE2300006","2":"B","3":"2018","4":"2480537","5":"270","6":"1963","7":"1000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="add-coverage-of-protected-areas" class="section level2">
<h2>Add coverage of protected areas</h2>
<p>To add the coverage of each protected area, we divide the area of occupancy by the area of each protected area defined as the number of cells totally covering the protected area:</p>
<pre class="r"><code>occs_prot_areas &lt;-
  occs_prot_areas %&gt;%
  left_join(n_cells_prot_areas,
    by = c(&quot;SITECODE&quot;)
  ) %&gt;%
  mutate(coverage = aoo / n_cells) %&gt;%
  select(-n_cells)</code></pre>
<pre><code>## left_join: added one column (n_cells)</code></pre>
<pre><code>##            &gt; rows only in x           0</code></pre>
<pre><code>##            &gt; rows only in y  (        0)</code></pre>
<pre><code>##            &gt; matched rows     1,880,337</code></pre>
<pre><code>##            &gt;                 ===========</code></pre>
<pre><code>##            &gt; rows total       1,880,337</code></pre>
<pre><code>## mutate: new variable &#39;coverage&#39; with 3,445 unique values and 0% NA</code></pre>
<pre><code>## select: dropped one variable (n_cells)</code></pre>
<p>The coverage is a number between 0 (species not present) and 1 (species present in the entire protected area). Preview the 10 highest coverage values:</p>
<pre class="r"><code>occs_prot_areas %&gt;%
  arrange(desc(coverage)) %&gt;%
  head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["SITECODE"],"name":[1],"type":["chr"],"align":["left"]},{"label":["SITETYPE"],"name":[2],"type":["chr"],"align":["left"]},{"label":["year"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["speciesKey"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["aoo"],"name":[5],"type":["int"],"align":["right"]},{"label":["n"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["min_coord_uncertainty"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["coverage"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"BE1000001","2":"B","3":"2012","4":"2477968","5":"50","6":"230","7":"1000","8":"1"},{"1":"BE1000001","2":"B","3":"2012","4":"2493091","5":"50","6":"199","7":"707","8":"1"},{"1":"BE1000001","2":"B","3":"2012","4":"2498261","5":"50","6":"168","7":"1000","8":"1"},{"1":"BE1000001","2":"B","3":"2013","4":"2498261","5":"50","6":"207","7":"1000","8":"1"},{"1":"BE1000001","2":"B","3":"2014","4":"2480537","5":"50","6":"289","7":"1000","8":"1"},{"1":"BE1000001","2":"B","3":"2014","4":"2482054","5":"50","6":"299","7":"1000","8":"1"},{"1":"BE1000001","2":"B","3":"2014","4":"2484916","5":"50","6":"327","7":"1000","8":"1"},{"1":"BE1000001","2":"B","3":"2014","4":"2487879","5":"50","6":"1046","7":"1000","8":"1"},{"1":"BE1000001","2":"B","3":"2014","4":"2490719","5":"50","6":"1454","7":"1000","8":"1"},{"1":"BE1000001","2":"B","3":"2014","4":"2492462","5":"50","6":"1261","7":"1000","8":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="retrieve-taxonomic-metadata-from-gbif" class="section level2">
<h2>Retrieve taxonomic metadata from GBIF</h2>
<p>Not all taxa in Belgian occurrence cube are present in protected areas. We remove them from the taxonomic metadata of the occurrence cube:</p>
<pre class="r"><code>prot_areas_species_info &lt;-
  be_species_info %&gt;%
  filter(speciesKey %in% occs_prot_areas$speciesKey)</code></pre>
<pre><code>## filter: removed 3,256 rows (20%), 13,311 rows remaining</code></pre>
<p>We retrieve taxonomic information from GBIF:</p>
<pre class="r"><code>prot_areas_species_taxon_info &lt;-
  map_dfr(
    prot_areas_species_info$speciesKey,
    function(x) {
      name_usage(key = x, return = &quot;data&quot;)
    }
  )
prot_areas_species_taxon_info &lt;-
  prot_areas_species_taxon_info %&gt;%
  select(
    key,
    kingdom,
    phylum,
    order,
    class,
    family,
    genusKey,
    genus,
    speciesKey,
    species
  )</code></pre>
<pre><code>## select: dropped 30 variables (scientificName, nubKey, nameKey, taxonID, sourceTaxonKey, …)</code></pre>
<pre class="r"><code>prot_areas_species_info &lt;-
  prot_areas_species_info %&gt;%
  left_join(prot_areas_species_taxon_info,
    by = &quot;speciesKey&quot;
  )</code></pre>
<pre><code>## left_join: added 9 columns (key, kingdom, phylum, order, class, …)</code></pre>
<pre><code>##            &gt; rows only in x        0</code></pre>
<pre><code>##            &gt; rows only in y  (     0)</code></pre>
<pre><code>##            &gt; matched rows     13,311</code></pre>
<pre><code>##            &gt;                 ========</code></pre>
<pre><code>##            &gt; rows total       13,311</code></pre>
<p>Preview:</p>
<pre class="r"><code>prot_areas_species_taxon_info %&gt;% head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["key"],"name":[1],"type":["int"],"align":["right"]},{"label":["kingdom"],"name":[2],"type":["chr"],"align":["left"]},{"label":["phylum"],"name":[3],"type":["chr"],"align":["left"]},{"label":["order"],"name":[4],"type":["chr"],"align":["left"]},{"label":["class"],"name":[5],"type":["chr"],"align":["left"]},{"label":["family"],"name":[6],"type":["chr"],"align":["left"]},{"label":["genusKey"],"name":[7],"type":["int"],"align":["right"]},{"label":["genus"],"name":[8],"type":["chr"],"align":["left"]},{"label":["speciesKey"],"name":[9],"type":["int"],"align":["right"]},{"label":["species"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"1001548","2":"Animalia","3":"Rotifera","4":"Ploima","5":"Eurotatoria","6":"Lepadellidae","7":"1001394","8":"Lepadella","9":"1001548","10":"Lepadella deridderae"},{"1":"1001728","2":"Animalia","3":"Rotifera","4":"Ploima","5":"Eurotatoria","6":"Dicranophoridae","7":"1001721","8":"Paradicranophorus","9":"1001728","10":"Paradicranophorus sinus"},{"1":"1001810","2":"Animalia","3":"Rotifera","4":"Ploima","5":"Eurotatoria","6":"Dicranophoridae","7":"1001777","8":"Encentrum","9":"1001810","10":"Encentrum tenuidigitatum"},{"1":"1002944","2":"Animalia","3":"Rotifera","4":"Ploima","5":"Eurotatoria","6":"Proalidae","7":"1001938","8":"Proales","9":"1002944","10":"Proales christinae"},{"1":"1003399","2":"Animalia","3":"Rotifera","4":"Ploima","5":"Eurotatoria","6":"Notommatidae","7":"1003319","8":"Cephalodella","9":"1003399","10":"Cephalodella segersi"},{"1":"1003567","2":"Animalia","3":"Bryozoa","4":"Plumatellida","5":"Phylactolaemata","6":"Pectinatellidae","7":"1003566","8":"Pectinatella","9":"1003567","10":"Pectinatella magnifica"},{"1":"1003652","2":"Animalia","3":"Bryozoa","4":"Plumatellida","5":"Phylactolaemata","6":"Cristatellidae","7":"1003651","8":"Cristatella","9":"1003652","10":"Cristatella mucedo"},{"1":"1008955","2":"Animalia","3":"Bryozoa","4":"Cheilostomatida","5":"Gymnolaemata","6":"Fenestrulinidae","7":"1008901","8":"Fenestrulina","9":"1008955","10":"Fenestrulina delicia"},{"1":"1012292","2":"Animalia","3":"Arthropoda","4":"Julida","5":"Diplopoda","6":"Julidae","7":"1012257","8":"Ommatoiulus","9":"1012292","10":"Ommatoiulus sabulosus"},{"1":"1020607","2":"Animalia","3":"Arthropoda","4":"Polydesmida","5":"Diplopoda","6":"Polydesmidae","7":"1014641","8":"Polydesmus","9":"1020607","10":"Polydesmus angustus"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="add-alien-status" class="section level2">
<h2>Add alien status</h2>
<p>We would also like to indicate whether the species is alien. We add a boolean column indicating whether the species is alien or not based on the unified checklist:</p>
<pre class="r"><code># add genusKey to species
occs_prot_areas &lt;-
  occs_prot_areas %&gt;%
  left_join(prot_areas_species_info %&gt;%
    select(speciesKey, genusKey),
  by = c(&quot;speciesKey&quot;)
  )</code></pre>
<pre><code>## select: dropped 12 variables (scientificName, rank, taxonomicStatus, includes, key, …)</code></pre>
<pre><code>## left_join: added one column (genusKey)</code></pre>
<pre><code>##            &gt; rows only in x           0</code></pre>
<pre><code>##            &gt; rows only in y  (        0)</code></pre>
<pre><code>##            &gt; matched rows     1,880,337</code></pre>
<pre><code>##            &gt;                 ===========</code></pre>
<pre><code>##            &gt; rows total       1,880,337</code></pre>
<pre class="r"><code>occs_prot_areas &lt;-
  occs_prot_areas %&gt;%
  mutate(is_alien = speciesKey %in% alien_taxa$nubKey |
    genusKey %in% alien_taxa$nubKey)</code></pre>
<pre><code>## mutate: new variable &#39;is_alien&#39; with 2 unique values and 0% NA</code></pre>
<p>As the Belgian list of alien taxa contains infraspecific taxa, it can occur that some of them contribute to the number of observations of species which are considered native. We add a remark for species where this could happen:</p>
<pre class="r"><code>species_infraspecific_alien &lt;-
  infraspecific_alien %&gt;%
  select(speciesKey, scientificName, key) %&gt;%
  filter(speciesKey %in% occs_prot_areas$speciesKey) %&gt;%
  group_by(speciesKey) %&gt;%
  summarize(remarks = paste0(
    &quot;Infraspecific alien taxa present. &quot;,
    paste(key,
      scientificName,
      sep = &quot;:&quot;,
      collapse = &quot;,&quot;
    )
  ))</code></pre>
<pre><code>## select: dropped 39 variables (nubKey, nameKey, taxonID, sourceTaxonKey, kingdom, …)</code></pre>
<pre><code>## filter: removed 21 rows (17%), 102 rows remaining</code></pre>
<pre><code>## group_by: one grouping variable (speciesKey)</code></pre>
<pre><code>## summarize: now 78 rows and 2 columns, ungrouped</code></pre>
<pre class="r"><code>occs_prot_areas &lt;-
  occs_prot_areas %&gt;%
  left_join(species_infraspecific_alien,
    by = &quot;speciesKey&quot;
  )</code></pre>
<pre><code>## left_join: added one column (remarks)</code></pre>
<pre><code>##            &gt; rows only in x   1,835,371</code></pre>
<pre><code>##            &gt; rows only in y  (        0)</code></pre>
<pre><code>##            &gt; matched rows        44,966</code></pre>
<pre><code>##            &gt;                 ===========</code></pre>
<pre><code>##            &gt; rows total       1,880,337</code></pre>
<p>Example of native species with alien infraspecific taxa:</p>
<pre class="r"><code>occs_prot_areas %&gt;%
  filter(!is.na(remarks)) %&gt;%
  select(speciesKey, is_alien, remarks) %&gt;%
  head(10)</code></pre>
<pre><code>## filter: removed 1,835,371 rows (98%), 44,966 rows remaining</code></pre>
<pre><code>## select: dropped 8 variables (SITECODE, SITETYPE, year, aoo, n, …)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["speciesKey"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["is_alien"],"name":[2],"type":["lgl"],"align":["right"]},{"label":["remarks"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"3065239","2":"FALSE","3":"Infraspecific alien taxa present. 3065244:Euphorbia amygdaloides subsp. robbiae (Turrill) Stace"},{"1":"3170819","2":"FALSE","3":"Infraspecific alien taxa present. 7482178:Kickxia elatine subsp. crinita (Mabille) W.Greuter"},{"1":"9040863","2":"FALSE","3":"Infraspecific alien taxa present. 7225621:Neslia paniculata subsp. paniculata"},{"1":"9063248","2":"FALSE","3":"Infraspecific alien taxa present. 2914404:Galium verum subsp. wirtgenii (F.W.Schultz) Oborny"},{"1":"5341197","2":"FALSE","3":"Infraspecific alien taxa present. 8167990:Lycopsis arvensis subsp. orientalis (L.) Kuzn."},{"1":"9063248","2":"FALSE","3":"Infraspecific alien taxa present. 2914404:Galium verum subsp. wirtgenii (F.W.Schultz) Oborny"},{"1":"2687927","2":"FALSE","3":"Infraspecific alien taxa present. 6387033:Equisetum hyemale subsp. affine (Engelm.) Calder & Roy L.Taylor"},{"1":"3170819","2":"FALSE","3":"Infraspecific alien taxa present. 7482178:Kickxia elatine subsp. crinita (Mabille) W.Greuter"},{"1":"5352367","2":"FALSE","3":"Infraspecific alien taxa present. 5352372:Anthyllis vulneraria subsp. polyphylla (DC.) Nyman,5352425:Anthyllis vulneraria subsp. carpatica (Pant.) Nyman"},{"1":"9063248","2":"FALSE","3":"Infraspecific alien taxa present. 2914404:Galium verum subsp. wirtgenii (F.W.Schultz) Oborny"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="save-data-and-metadata" class="section level1">
<h1>Save data and metadata</h1>
<div id="save-protected-area-analysis" class="section level2">
<h2>Save protected area analysis</h2>
<p>We finalize the data.frame containing the information about number of observations, occupancy, coverage and alien status in Belgian protected areas.</p>
<p>Select column of interest and set columns order:</p>
<pre class="r"><code>occs_prot_areas &lt;-
  occs_prot_areas %&gt;%
  select(
    SITECODE,
    SITETYPE,
    year,
    speciesKey,
    n,
    aoo,
    coverage,
    min_coord_uncertainty,
    is_alien,
    remarks
  )</code></pre>
<pre><code>## select: dropped one variable (genusKey)</code></pre>
<p>Save data:</p>
<pre class="r"><code>occs_prot_areas %&gt;%
  write_tsv(
    path = here::here(
      &quot;data&quot;,
      &quot;output&quot;,
      &quot;analysis_protected_areas.tsv&quot;
    ),
    na = &quot;&quot;
  )</code></pre>
</div>
<div id="finalize-en-save-metadata" class="section level2">
<h2>Finalize en save metadata</h2>
<div id="taxonomic-metadata" class="section level3">
<h3>Taxonomic metadata</h3>
<p>Select taxonomic metadata we are interested to:</p>
<pre class="r"><code>taxonomic_metadata &lt;-
  prot_areas_species_info %&gt;%
  select(
    speciesKey,
    scientificName,
    kingdom,
    phylum,
    order,
    class,
    genus,
    family,
    species,
    rank,
    includes
  )</code></pre>
<pre><code>## select: dropped 3 variables (taxonomicStatus, key, genusKey)</code></pre>
<pre class="r"><code>taxonomic_metadata %&gt;%
  write_tsv(here::here(
    &quot;data&quot;,
    &quot;output&quot;,
    &quot;protected_areas_species_info.csv&quot;
  ),
  na = &quot;&quot;
  )</code></pre>
</div>
<div id="protected-areas-metadata-1" class="section level3">
<h3>Protected areas metadata</h3>
<p>We remove metadata of areas without observations:</p>
<pre class="r"><code>protected_areas_metadata &lt;-
  protected_areas_metadata %&gt;%
  filter(SITECODE %in% occs_prot_areas$SITECODE)</code></pre>
<pre><code>## filter: no rows removed</code></pre>
<p>We save the metadata as output:</p>
<pre class="r"><code>protected_areas_metadata %&gt;%
  write_tsv(
    path = here::here(
      &quot;data&quot;,
      &quot;output&quot;,
      &quot;protected_areas_metadata.tsv&quot;
    ),
    na = &quot;&quot;
  )</code></pre>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
